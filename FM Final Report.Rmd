---
title: "FM Final Report"
author: "Sara"
date: "May 21, 2018"
output: html_document
---

```{r fmdata1, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
setwd("C:/Users/saraa/Desktop")
```
### BACKGROUND
#### Farmer's markets are a key factor in the health of a population due to greater proximity to quality food sources and greater trust from consumers because they can get to know their local farmers and trust that the food is produced to their standards.  With news stories of food recalls due to pathogens such as E. Coli O157:H7 in romaine lettuce (https://www.cdc.gov/ecoli/2018/o157h7-04-18/index.html) or foreign matter such as hard plastic in chicken breasts (https://www.fsis.usda.gov/wps/portal/fsis/topics/recalls-and-public-health-alerts/recall-case-archive/archive/2018/recall-026-2018-release), farmer's markets can be seen as a source of food produced closer to home, with less risk of contamination. Farmer's markets that sell a greater variety of foods and accept non-cash methods of payment may be likelier to draw more customers and increase their presence in the local areas.

#### This project uses data pertaining to farmer's markets per 1,000 people in 2009 (FMRKTPTH09) and 2016 (FMRKTPTH16); markets that in 2016 sold produce (FMRKT_FRVEG16), animal products (FMRKT_ANMLPROD16), baked goods (FMRKT_BAKED16), and other foods (FMRKT_OTHERFOOD16); and accepted credit cards (FMRKT_CREDIT16), Supplemental Nutrition Assistance Program or food stamps (FMRKT_SNAP16), Women, Infants, and Children (FMRKT_WIC16); WICCash Vouchers (FMRKT_WICCASH16), and Senior Farmer's Market Nutrition Program (FMRKT_SFMNP16).

### ABOUT THE DATA
#### The data comes from the Food Environment Atlas data, updated March 27, 2018.  This dataset was compiled by the United States Department of Agriculture (USDA). This dataset contains 3,143 records, one for each county or county-equivalent in the United States, and 14 columns. https://www.ers.usda.gov/data-products/food-environment-atlas/data-access-and-documentation-downloads/

#### With only two years in this data, 2009 and 2016, other factors such as rules and regulations that passed in preceding years that impact the growth of farmer's markets may have been missed.  Other characteristics that may impact the growth of markets, such as vendors that sell nonfood items, food truck vendors, and on-site entertainment, are also not in this dataset, nor are data that showed which types of markets increased or decreased between 2009 and 2016.  Dollar sales figures, which could also help in tracking the growth of farmer's markets, are also not in this data.

### DATA WRANGLING
#### After loading the data, columns that did not add value to the analysis were removed. These included columns with data not relevant to farmer's markets, the total number of markets in each county (as a change in this number is more vague in measuring the growth or decline), the percentages of each kind of market, and the percent change from 2009 to 2016 (as a percent increase from zero would produce invalid data).

```{r fmdata2, echo=TRUE}
fmdata <- read.csv("fe_local_original.csv")
fmdata <- fmdata[, -c(4:19,22,24,26,28,30,32,34,36,38,40:100)]
```

####Thesse are the definitions of the variables.

* FIPSTXT <- Federal Information Processing Standard, the unique identifiers for each county
* FMRKTPTH09 <- Farmer's markets per 1,000 people in each county in 2009
* FMRKTPTH16 <- Farmer's markets per 1,000 people in each county in 2016
* FMRKT_SNAP16 <- Number of farmer's markets in each county that accepted Supplemental Nutrition Assistance Program (SNAP) benefits in 2016.
* FMRKT_WIC16 <- Number of farmer's markets in each county that accepted Women, Infants, and Children (WIC) benefits in 2016.
* FMRKT_WICCASH16 <- Number of farmer's markets in each county that accepted WIC Cash Value Vouchers (WICCash) in 2016.
* FMRKT_SFMNP16 <- Number of farmer's markets in each county that accepted Senior Farmers' Market Nutrition Program (SFMNP) benefits in 2016.
* FMRKT_CREDIT16 <- Number of farmer's markets in each county that accepted credit cards in 2016.
* FMRKT_FRVEG16 <- Number of farmer's markets in each county that sold fruits and vegetables in 2016.
* FMRKT_ANMLPROD16 <- Number of farmer's markets in each county that sold meat and dairy in 2016.
* FMRKT_BAKED16 <- Number of farmer's markets in each county that sold baked goods in 2016.
* FMRKT_OTHERFOOD16 <- Number of farmer's markets in each county that sold other food products in 2016.

#### The titles of the columns were changed into names that are easier to understand.

```{r fmdata3, echo=TRUE}
#Make titles of remaining columns easier to understand
colnames(fmdata)[colnames(fmdata)=="FMRKTPTH09"] <- "Markets2009"
colnames(fmdata)[colnames(fmdata)=="FMRKTPTH16"] <- "Markets2016"
colnames(fmdata)[colnames(fmdata)=="FMRKT_SNAP16"] <- "SNAP"
colnames(fmdata)[colnames(fmdata)=="FMRKT_WIC16"] <- "WIC"
colnames(fmdata)[colnames(fmdata)=="FMRKT_WICCASH16"] <- "WICCash"
colnames(fmdata)[colnames(fmdata)=="FMRKT_SFMNP16"] <- "Senior"
colnames(fmdata)[colnames(fmdata)=="FMRKT_CREDIT16"] <- "CreditCards"
colnames(fmdata)[colnames(fmdata)=="FMRKT_FRVEG16"] <- "Produce"
colnames(fmdata)[colnames(fmdata)=="FMRKT_ANMLPROD16"] <- "Animal"
colnames(fmdata)[colnames(fmdata)=="FMRKT_BAKED16"] <- "Baked"
colnames(fmdata)[colnames(fmdata)=="FMRKT_OTHERFOOD16"] <- "OtherFood"
```

#### The numbers of markets per 1,000 were rounded to the nearest thousandth to make the numbers with many digits to the right of the decimal point easier to read, and to make more precise numbers for easier analysis. With these rounded numbers, I could apply them to the numbers of each type of market to add new columns of each type of market per 1,000 people.

```{r fmdata4, echo=TRUE}
#Convert numbers to percentages rounded to the nearest thousandth
fmdata$Markets2009 <- round(fmdata$Markets2009, 3)
fmdata$Markets2016 <- round(fmdata$Markets2016, 3)
```

#### Other columns were added to aid in the analysis, including the difference between markets in 2009 and 2016, a column with Boolean values showing whether or not farmer's markets per 1,000 people increased (0 for false, 1 for true), and columns with Boolean values showing whether or not each type of market was present.

```{r fmdata5, echo=TRUE}
#Add columns showing the different kinds of markets per 1,000 people
fmdata$SNAP1000 <- fmdata$SNAP*fmdata$Markets2016
fmdata$WIC1000 <- fmdata$WIC*fmdata$Markets2016
fmdata$WICCash1000 <- fmdata$WICCash*fmdata$Markets2016
fmdata$Senior1000 <- fmdata$Senior*fmdata$Markets2016
fmdata$CreditCards1000 <- fmdata$CreditCards*fmdata$Markets2016
fmdata$Produce1000 <- fmdata$Produce*fmdata$Markets2016
fmdata$Animal1000 <- fmdata$Animal*fmdata$Markets2016
fmdata$Baked1000 <- fmdata$Baked*fmdata$Markets2016
fmdata$OtherFood1000 <- fmdata$OtherFood*fmdata$Markets2016

#Add column showing the difference between Markets2009 and Markets2016
fmdata$Difference <- fmdata$Markets2016 - fmdata$Markets2009

#Add column showing whether or not farmer's markets increased their presence in counties between 2009 and 2016
fmdata$Increased <- ifelse(fmdata$Difference > '0',1,0)

#Create dummy variables for the different kinds of farmer's markets.
fmdata$Present_2009 <- ifelse(fmdata$Markets2009== '0',0,1)
fmdata$Present_2016 <- ifelse(fmdata$Markets2016== '0',0,1)
fmdata$Accepts_SNAP <- ifelse(fmdata$SNAP== '0',0,1)
fmdata$Accepts_WIC <- ifelse(fmdata$WIC== '0',0,1)
fmdata$Accepts_WICCash <- ifelse(fmdata$WICCash== '0',0,1)
fmdata$Accepts_Senior <- ifelse(fmdata$Senior== '0',0,1)
fmdata$Accepts_CreditCards <- ifelse(fmdata$CreditCards== '0',0,1)
fmdata$Sells_Produce <- ifelse(fmdata$Produce== '0',0,1)
fmdata$Sells_Animal <- ifelse(fmdata$Animal== '0',0,1)
fmdata$Sells_Baked <- ifelse(fmdata$Baked== '0',0,1)
fmdata$Sells_OtherFood <- ifelse(fmdata$OtherFood== '0',0,1)
```

#### Columns with Boolean values showing whether or not a county was in a particular state were added.

```{r fmdata6, echo=TRUE}
fmdata$Alabama <- ifelse(fmdata$State== 'AL',1,0)
fmdata$Alaska <- ifelse(fmdata$State== 'AK',1,0)
fmdata$Arizona <- ifelse(fmdata$State== 'AZ',1,0)
fmdata$Arkansas <- ifelse(fmdata$State== 'AR',1,0)
fmdata$California <- ifelse(fmdata$State== 'CA',1,0)
fmdata$Colorado <- ifelse(fmdata$State== 'CO',1,0)
fmdata$Connecticut <- ifelse(fmdata$State== 'CT',1,0)
fmdata$Delaware <- ifelse(fmdata$State== 'DE',1,0)
fmdata$DistrictofColumbia <- ifelse(fmdata$State== 'DC',1,0)
fmdata$Florida <- ifelse(fmdata$State== 'FL',1,0)
fmdata$Georgia <- ifelse(fmdata$State== 'GA',1,0)
fmdata$Hawaii <- ifelse(fmdata$State== 'HI',1,0)
fmdata$Idaho <- ifelse(fmdata$State== 'ID',1,0)
fmdata$Illinois <- ifelse(fmdata$State== 'IL',1,0)
fmdata$Indiana <- ifelse(fmdata$State== 'IN',1,0)
fmdata$Iowa <- ifelse(fmdata$State== 'IA',1,0)
fmdata$Kansas <- ifelse(fmdata$State== 'KS',1,0)
fmdata$Kentucky <- ifelse(fmdata$State== 'KY',1,0)
fmdata$Louisiana <- ifelse(fmdata$State== 'LA',1,0)
fmdata$Maine <- ifelse(fmdata$State== 'ME',1,0)
fmdata$Maryland <- ifelse(fmdata$State== 'MD',1,0)
fmdata$Massachusetts <- ifelse(fmdata$State== 'MA',1,0)
fmdata$Michigan <- ifelse(fmdata$State== 'MI',1,0)
fmdata$Minnesota <- ifelse(fmdata$State== 'MN',1,0)
fmdata$Mississippi <- ifelse(fmdata$State== 'MS',1,0)
fmdata$Missouri <- ifelse(fmdata$State== 'MO',1,0)
fmdata$Montana <- ifelse(fmdata$State== 'MT',1,0)
fmdata$Nebraska <- ifelse(fmdata$State== 'NE',1,0)
fmdata$Nevada <- ifelse(fmdata$State== 'NV',1,0)
fmdata$NewHampshire <- ifelse(fmdata$State== 'NH',1,0)
fmdata$NewJersey <- ifelse(fmdata$State== 'NJ',1,0)
fmdata$NewMexico <- ifelse(fmdata$State== 'NM',1,0)
fmdata$NewYork <- ifelse(fmdata$State== 'NY',1,0)
fmdata$NorthCarolina <- ifelse(fmdata$State== 'NC',1,0)
fmdata$NorthDakota <- ifelse(fmdata$State== 'ND',1,0)
fmdata$Ohio <- ifelse(fmdata$State== 'OH',1,0)
fmdata$Oklahoma <- ifelse(fmdata$State== 'OK',1,0)
fmdata$Oregon <- ifelse(fmdata$State== 'OR',1,0)
fmdata$Pennsylvania <- ifelse(fmdata$State== 'PA',1,0)
fmdata$RhodeIsland <- ifelse(fmdata$State== 'RI',1,0)
fmdata$SouthCarolina <- ifelse(fmdata$State== 'SC',1,0)
fmdata$SouthDakota <- ifelse(fmdata$State== 'SD',1,0)
fmdata$Tennessee <- ifelse(fmdata$State== 'TN',1,0)
fmdata$Texas <- ifelse(fmdata$State== 'TX',1,0)
fmdata$Utah <- ifelse(fmdata$State== 'UT',1,0)
fmdata$Vermont <- ifelse(fmdata$State== 'VT',1,0)
fmdata$Virginia <- ifelse(fmdata$State== 'VA',1,0)
fmdata$Washington <- ifelse(fmdata$State== 'WA',1,0)
fmdata$WestVirginia <- ifelse(fmdata$State== 'WV',1,0)
fmdata$Wisconsin <- ifelse(fmdata$State== 'WI',1,0)
fmdata$Wyoming <- ifelse(fmdata$State== 'WY',1,0)
```

####Columns of four regions in the United States (Midwest, Northeast, South, West) were added by combining the states in each region. Examining these columns showed the values as characters, so they were converted to numeric.

```{r fmdata7, echo=TRUE}
fmdata$Midwest <- paste(fmdata$Illinois+fmdata$Indiana+fmdata$Iowa+fmdata$Kansas+fmdata$Michigan+fmdata$Minnesota+fmdata$Missouri+fmdata$Nebraska+fmdata$NorthDakota+fmdata$Ohio+fmdata$SouthDakota+fmdata$Wisconsin)
fmdata$Northeast <- paste(fmdata$Connecticut+fmdata$Delaware+fmdata$DistrictofColumbia+fmdata$Maine+fmdata$Maryland+fmdata$Massachusetts+fmdata$NewHampshire+fmdata$NewJersey+fmdata$NewYork+fmdata$Pennsylvania+fmdata$RhodeIsland+fmdata$Vermont)
fmdata$South <- paste(fmdata$Alabama+fmdata$Arkansas+fmdata$Florida+fmdata$Georgia+fmdata$Kentucky+fmdata$Louisiana+fmdata$Mississippi+fmdata$NorthCarolina+fmdata$Oklahoma+fmdata$SouthCarolina+fmdata$Tennessee+fmdata$Texas+fmdata$Virginia+fmdata$WestVirginia)
fmdata$West <- paste(fmdata$Alaska+fmdata$Arizona+fmdata$California+fmdata$Colorado+fmdata$Hawaii+fmdata$Idaho+fmdata$Montana+fmdata$Nevada+fmdata$NewMexico+fmdata$Oregon+fmdata$Utah+fmdata$Washington+fmdata$Wyoming)

fmdata$Midwest <- as.numeric(as.character(fmdata$Midwest))
fmdata$Northeast <- as.numeric(as.character(fmdata$Northeast))
fmdata$South <- as.numeric(as.character(fmdata$South))
fmdata$West <- as.numeric(as.character(fmdata$West))
```

####All empty cells (NA) were replaced with zeroes as they were in the rows with zero markets.

```{r fmdata8, echo=TRUE}
#Replace NAs with zeroes
fmdata[is.na(fmdata)] <- 0
```

####A logarithmic transformation function was added to normalize the data consisting of markets per 1,000 people. The function was applied to the data of markets per 1,000 people and then the data was normalized and rounded to the nearest thousandth.

```{r fmdata9, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
#Logarithmic transformation
signedlog10 = function(x) {
  ifelse(abs(x) <= 1, 0, sign(x)*log10(abs(x)))
}

#Apply logarithmic transformation, normalize data, and round to the nearest thousandth
fmdata$Markets_2009_norm <- signedlog10(fmdata$Markets2009)
fmdata$Markets_2009_norm <- rnorm(fmdata$Markets_2009_norm)
fmdata$Markets_2009_norm <- round(fmdata$Markets_2009_norm, 3)

fmdata$Markets_2016_norm <- signedlog10(fmdata$Markets2016)
fmdata$Markets_2016_norm <- rnorm(fmdata$Markets_2016_norm)
fmdata$Markets_2016_norm <- round(fmdata$Markets_2016_norm, 3)

fmdata$SNAP_norm <- signedlog10(fmdata$SNAP1000)
fmdata$SNAP_norm <- rnorm(fmdata$SNAP_norm)
fmdata$SNAP_norm <- round(fmdata$SNAP_norm, 3)

fmdata$WIC_norm <- signedlog10(fmdata$WIC1000)
fmdata$WIC_norm <- rnorm(fmdata$WIC_norm)
fmdata$WIC_norm <- round(fmdata$WIC_norm, 3)

fmdata$WICCash_norm <- signedlog10(fmdata$WICCash1000)
fmdata$WICCash_norm <- rnorm(fmdata$WICCash_norm)
fmdata$WICCash_norm <- round(fmdata$WICCash_norm, 3)

fmdata$Senior_norm <- signedlog10(fmdata$Senior1000)
fmdata$Senior_norm <- rnorm(fmdata$Senior_norm)
fmdata$Senior_norm <- round(fmdata$Senior_norm, 3)

fmdata$CreditCards_norm <- signedlog10(fmdata$CreditCards1000)
fmdata$CreditCards_norm <- rnorm(fmdata$CreditCards_norm)
fmdata$CreditCards_norm <- round(fmdata$CreditCards_norm, 3)

fmdata$Produce_norm <- signedlog10(fmdata$Produce1000)
fmdata$Produce_norm <- rnorm(fmdata$Produce_norm)
fmdata$Produce_norm <- round(fmdata$Produce_norm, 3)

fmdata$Animal_norm <- signedlog10(fmdata$Animal1000)
fmdata$Animal_norm <- rnorm(fmdata$Animal_norm)
fmdata$Animal_norm <- round(fmdata$Animal_norm, 3)

fmdata$Baked_norm <- signedlog10(fmdata$Baked1000)
fmdata$Baked_norm <- rnorm(fmdata$Baked_norm)
fmdata$Baked_norm <- round(fmdata$Baked_norm, 3)

fmdata$OtherFood_norm <- signedlog10(fmdata$OtherFood1000)
fmdata$OtherFood_norm <- rnorm(fmdata$OtherFood_norm)
fmdata$OtherFood_norm <- round(fmdata$OtherFood_norm, 3)
```

####The data was exported to the new cleaned CSV file.

```{r fmdata10, echo=TRUE}
#Replace NAs with zeroes
write.csv(fmdata, "fe_local_clean.csv")
```

### STATISTICS AND VISUALIZAION

#### First the necessary libraries were opened and the cleaned data loaded.

```{r fmdata11, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(plyr)
library(dplyr)
library(ggplot2)
library(ggpubr)
library(plotly)
library(reshape2)
library(tidyr)
library(tinytex)
library(caret)

fmdata <- read.csv("fe_local_clean.csv")
```

#### A function "percent" was added to convert calculations to percentages.

```{r fmdata12, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
percent <- function(x, digits = 2, format = "f", ...) {
  paste0(formatC(100 * x, format = format, digits = digits, ...), "%")
}
```

#### What percentage of counties saw an increase in farmer's markets per 1,000 people from 2009 to 2016?

```{r fmdata13, echo=FALSE}
moremkts <- fmdata[fmdata$Increased == "1",]
proportion_more <- nrow(moremkts)/nrow(fmdata)
percent(proportion_more)
```

#### What percentage of these counties sell all food types?

```{r fmdata14, echo=FALSE}
allfoods <- data.frame(moremkts$Sells_Produce, moremkts$Sells_Animal, moremkts$Sells_Baked, moremkts$Sells_OtherFood)
count_allfoods <- allfoods[rowSums(allfoods == 0) < 1, ]
allfoods <- nrow(count_allfoods)/nrow(moremkts)
percent(allfoods)
```

#### What percentage of all counties sell all types of food products?

```{r fmdata15, echo=FALSE}
allfoods_all <- data.frame(fmdata$Sells_Produce, fmdata$Sells_Animal, fmdata$Sells_Baked, fmdata$Sells_OtherFood)
count_allfoods_all <- allfoods_all[rowSums(allfoods_all == 0) < 1, ]
allfoods_all <- nrow(count_allfoods_all)/nrow(fmdata)
percent(allfoods_all)
```

#### What percentage of these counties accept all noncash methods of payment?

```{r fmdata16, echo=FALSE}
noncash <- data.frame(moremkts$CreditCards, moremkts$Accepts_SNAP, moremkts$Accepts_WIC, moremkts$Accepts_WICCash, moremkts$Accepts_Senior)
count_noncash <- noncash[rowSums(noncash == 0) < 1, ]
noncash <- nrow(count_noncash)/nrow(moremkts)
percent(noncash)
```

#### What percentage of all counties accept all noncash payments?

```{r fmdata17, echo=FALSE}
noncash_all <- data.frame(fmdata$CreditCards, fmdata$Accepts_SNAP, fmdata$Accepts_WIC, fmdata$Accepts_WICCash, fmdata$Accepts_Senior)
count_noncash_all <- noncash_all[rowSums(noncash_all == 0) < 1, ]
noncash_all <- nrow(count_noncash_all)/nrow(fmdata)
percent(noncash_all)
```

#### What percentage of counties that saw increases are in the Midwest?
```{r fmdata18, echo=TRUE}
MoreMktMidwest <- data.frame(moremkts$Illinois, moremkts$Indiana, moremkts$Iowa, moremkts$Kansas, moremkts$Michigan, moremkts$Minnesota, moremkts$Missouri, moremkts$Nebraska, moremkts$NorthDakota, moremkts$Ohio, moremkts$SouthDakota, moremkts$Wisconsin)
count_midwest <- MoreMktMidwest[rowSums(MoreMktMidwest == 1), ]
midwest <- nrow(count_midwest)/nrow(moremkts)
percent(midwest)
```

#### What percentage of all counties are in the Midwest?
```{r fmdata19, echo=TRUE}
MktMidwest <- data.frame(fmdata$Illinois, fmdata$Indiana, fmdata$Iowa, fmdata$Kansas, fmdata$Michigan, fmdata$Minnesota, fmdata$Missouri, fmdata$Nebraska, fmdata$NorthDakota, fmdata$Ohio, fmdata$SouthDakota, fmdata$Wisconsin)
count_midwest <- MktMidwest[rowSums(MktMidwest == 1), ]
midwest <- nrow(count_midwest)/nrow(fmdata)
percent(midwest)
```

#### What percentage of counties that saw increases are in the Northeast?
```{r fmdata20, echo=TRUE}
MoreMktNortheast <- data.frame(moremkts$Connecticut, moremkts$Delaware, moremkts$DistrictofColumbia, moremkts$Maine, moremkts$Maryland, moremkts$Massachusetts, moremkts$NewHampshire, moremkts$NewJersey, moremkts$NewYork, moremkts$Pennsylvania, moremkts$RhodeIsland, moremkts$Vermont)
count_northeast <- MoreMktNortheast[rowSums(MoreMktNortheast == 1), ]
northeast <- nrow(count_northeast)/nrow(moremkts)
percent(northeast)
```

#### What percentage of all counties are in the Northeast?
```{r fmdata21, echo=TRUE}
MktNortheast <- data.frame(fmdata$Connecticut, fmdata$Delaware, fmdata$DistrictofColumbia, fmdata$Maine, fmdata$Maryland, fmdata$Massachusetts, fmdata$NewHampshire, fmdata$NewJersey, fmdata$NewYork, fmdata$Pennsylvania, fmdata$RhodeIsland, fmdata$Vermont)
count_northeast <- MktNortheast[rowSums(MktNortheast == 1), ]
northeast <- nrow(count_northeast)/nrow(fmdata)
percent(northeast)
```

#### What percentage of counties that saw increases are in the South?
```{r fmdata22, echo=TRUE}
MoreMktSouth <- data.frame(moremkts$Alabama, moremkts$Arkansas, moremkts$Florida, moremkts$Georgia, moremkts$Kentucky, moremkts$Louisiana, moremkts$Mississippi, moremkts$NorthCarolina, moremkts$Oklahoma, moremkts$SouthCarolina, moremkts$Tennessee, moremkts$Texas, moremkts$Virginia, moremkts$WestVirginia)
count_south <- MoreMktSouth[rowSums(MoreMktSouth == 1), ]
south <- nrow(count_south)/nrow(moremkts)
percent(south)
```

#### What percentage of all counties are in the South?
```{r fmdata23, echo=TRUE}
MktSouth <- data.frame(fmdata$Alabama, fmdata$Arkansas, fmdata$Florida, fmdata$Georgia, fmdata$Kentucky, fmdata$Louisiana, fmdata$Mississippi, fmdata$NorthCarolina, fmdata$Oklahoma, fmdata$SouthCarolina, fmdata$Tennessee, fmdata$Texas, fmdata$Virginia, fmdata$WestVirginia)
count_south <- MktSouth[rowSums(MktSouth == 1), ]
south <- nrow(count_south)/nrow(fmdata)
percent(south)
```

#### What percentage of counties that saw increases are in the West?
```{r fmdata24, echo=TRUE}
MoreMktWest <- data.frame(moremkts$Alaska, moremkts$Arizona, moremkts$California, moremkts$Colorado, moremkts$Hawaii, moremkts$Idaho, moremkts$Montana, moremkts$Nevada, moremkts$NewMexico, moremkts$Oregon, moremkts$Utah, moremkts$Washington, moremkts$Wyoming)
count_west <- MoreMktWest[rowSums(MoreMktWest == 1), ]
west <- nrow(count_west)/nrow(moremkts)
percent(west)
```

#### What percentage of all counties are in the West?
```{r fmdata25, echo=TRUE}
MktWest <- data.frame(fmdata$Alaska, fmdata$Arizona, fmdata$California, fmdata$Colorado, fmdata$Hawaii, fmdata$Idaho, fmdata$Montana, fmdata$Nevada, fmdata$NewMexico, fmdata$Oregon, fmdata$Utah, fmdata$Washington, fmdata$Wyoming)
count_west <- MktWest[rowSums(MktWest == 1), ]
west <- nrow(count_west)/nrow(fmdata)
percent(west)
```

#### From these calculations, the Midwest looks slightly overrepresented in counties that saw an increase in markets, the Northeast overrepresented, the South underrepresented, and the West slightly underrepresented.

### Histograms
```{r fmdata26, echo=TRUE}
ggplot (moremkts, aes(Produce_norm)) + 
  geom_histogram(binwidth = 0.05,col="green3",fill="green4",alpha = .5)+
  ggtitle("Produce-selling markets/1,000 people in counties that saw increases")+
  scale_x_continuous(name="Markets (per 1,000 people)")+
  scale_y_continuous(name="Number of Counties")

ggplot (fmdata, aes(Produce_norm)) + 
  geom_histogram(binwidth = 0.05,col="green1",fill="green2",alpha = .5)+
  ggtitle("Produce-selling markets/1,000 people in all counties")+
  scale_x_continuous(name="Markets (per 1,000 people)")+
  scale_y_continuous(name="Number of Counties")
```

#### Comparing markets that sell produce in counties that saw an increase in farmer's markets with markets in all counties. The means look similar.

```{r fmdata27, echo=TRUE}
ggplot (moremkts, aes(Animal_norm)) + 
  geom_histogram(binwidth = 0.05,col="red3",fill="red4",alpha = .5)+
  ggtitle("Animal-selling markets/1,000 people in counties that saw increases")+
  scale_x_continuous(name="Markets (per 1,000 people)")+
  scale_y_continuous(name="Number of Counties")

ggplot (fmdata, aes(Animal_norm)) + 
  geom_histogram(binwidth = 0.05,col="red1",fill="red2",alpha = .5)+
  ggtitle("Animal-selling markets/1,000 people in all counties")+
  scale_x_continuous(name="Markets (per 1,000 people)")+
  scale_y_continuous(name="Number of Counties")
```

#### Comparing markets that sell animal products in counties that saw an increase in farmer's markets with markets in all counties. The mean of the "increase" histogram looks slightly higher than the "overall" histogram.

```{r fmdata28, echo=TRUE}
ggplot (moremkts, aes(Baked_norm)) + 
  geom_histogram(binwidth = 0.05,col="yellow3",fill="yellow4",alpha = .5)+
  ggtitle("Baked goods-selling markets/1,000 people in counties that saw increases")+
  scale_x_continuous(name="Markets (per 1,000 people)")+
  scale_y_continuous(name="Number of Counties")

ggplot (fmdata, aes(Baked_norm)) + 
  geom_histogram(binwidth = 0.05,col="yellow1",fill="yellow2",alpha = .5)+
  ggtitle("Baked goods-selling markets/1,000 people in all counties")+
  scale_x_continuous(name="Markets (per 1,000 people)")+
  scale_y_continuous(name="Number of Counties")
```

#### Comparing markets that sell baked goods in counties that saw an increase in farmer's markets with markets in all counties. The mean of the "increase" histogram looks slightly higher than the "overall" histogram.

```{r fmdata29, echo=TRUE}
ggplot (moremkts, aes(OtherFood_norm)) + 
  geom_histogram(binwidth = 0.05,col="blue3",fill="blue4",alpha = .5)+
  ggtitle("Other-selling markets/1,000 people in counties that saw increases")+
  scale_x_continuous(name="Markets (per 1,000 people)")+
  scale_y_continuous(name="Number of Counties")

ggplot (fmdata, aes(OtherFood_norm)) + 
  geom_histogram(binwidth = 0.05,col="blue1",fill="blue2",alpha = .5)+
  ggtitle("Other-selling markets/1,000 people in all counties")+
  scale_x_continuous(name="Markets (per 1,000 people)")+
  scale_y_continuous(name="Number of Counties")
```

#### Comparing markets that sell other food products in counties that saw an increase in farmer's markets with markets in all counties. The mean of the "increase" histogram looks slightly higher than the "overall" histogram.

```{r fmdata30, echo=TRUE}
ggplot (moremkts, aes(CreditCards_norm)) + 
  geom_histogram(binwidth = 0.05,col="turquoise3",fill="turquoise4",alpha = .5)+
  ggtitle("Credit Card-accepting markets/1,000 people in counties that saw increases")+
  scale_x_continuous(name="Markets (per 1,000 people)")+
  scale_y_continuous(name="Number of Counties")

ggplot (fmdata, aes(CreditCards_norm)) + 
  geom_histogram(binwidth = 0.05,col="turquoise1",fill="turquoise2",alpha = .5)+
  ggtitle("Credit Card-accepting markets/1,000 people in all counties")+
  scale_x_continuous(name="Markets (per 1,000 people)")+
  scale_y_continuous(name="Number of Counties")
```

#### Comparing markets that accept credit cards in counties that saw an increase in farmer's markets with markets in all counties. The mean of the "increase" histogram looks slightly higher than the "overall" histogram.

```{r fmdata31, echo=TRUE}
ggplot (moremkts, aes(SNAP_norm)) + 
  geom_histogram(binwidth = 0.05,col="seagreen3",fill="seagreen4",alpha = .5)+
  ggtitle("SNAP-accepting markets/1,000 people in counties that saw increases")+
  scale_x_continuous(name="Markets (per 1,000 people)")+
  scale_y_continuous(name="Number of Counties")

ggplot (fmdata, aes(SNAP_norm)) + 
  geom_histogram(binwidth = 0.05,col="seagreen1",fill="seagreen2",alpha = .5)+
  ggtitle("SNAP-accepting markets/1,000 people in all counties")+
  scale_x_continuous(name="Markets (per 1,000 people)")+
  scale_y_continuous(name="Number of Counties")
```

#### Comparing markets that accept SNAP in counties that saw an increase in farmer's markets with markets in all counties. The means look similar.

```{r fmdata32, echo=TRUE}
ggplot (moremkts, aes(WIC_norm)) + 
  geom_histogram(binwidth = 0.05,col="darkgoldenrod3",fill="darkgoldenrod4",alpha = .5)+
  ggtitle("WIC-accepting markets/1,000 people in counties that saw increases")+
  scale_x_continuous(name="Markets (per 1,000 people)")+
  scale_y_continuous(name="Number of Counties")

ggplot (fmdata, aes(WIC_norm)) + 
  geom_histogram(binwidth = 0.05,col="darkgoldenrod1",fill="darkgoldenrod2",alpha = .5)+
  ggtitle("WIC-accepting markets/1,000 people in all counties")+
  scale_x_continuous(name="Markets (per 1,000 people)")+
  scale_y_continuous(name="Number of Counties")
```

#### Comparing markets that accept WIC in counties that saw an increase in farmer's markets with markets in all counties. The means look similar.

```{r fmdata33, echo=TRUE}
ggplot (moremkts, aes(WICCash_norm)) + 
  geom_histogram(binwidth = 0.05,col="hotpink3",fill="hotpink4",alpha = .5)+
  ggtitle("WICCash-accepting markets/1,000 people in counties that saw increases")+
  scale_x_continuous(name="Markets (per 1,000 people)")+
  scale_y_continuous(name="Number of Counties")

ggplot (fmdata, aes(WICCash_norm)) + 
  geom_histogram(binwidth = 0.05,col="hotpink1",fill="hotpink2",alpha = .5)+
  ggtitle("WICCash-accepting markets/1,000 people in all counties")+
  scale_x_continuous(name="Markets (per 1,000 people)")+
  scale_y_continuous(name="Number of Counties")
```

#### Comparing markets that accept WICCash in counties that saw an increase in farmer's markets with markets in all counties. The means look similar.

```{r fmdata34, echo=TRUE}
ggplot (moremkts, aes(Senior_norm)) + 
  geom_histogram(binwidth = 0.05,col="purple3",fill="purple4",alpha = .5)+
  ggtitle("SFMNP-accepting markets/1,000 people in counties that saw increases")+
  scale_x_continuous(name="Markets (per 1,000 people)")+
  scale_y_continuous(name="Number of Counties")

ggplot (fmdata, aes(Senior_norm)) + 
  geom_histogram(binwidth = 0.05,col="purple1",fill="purple2",alpha = .5)+
  ggtitle("SFMNP-accepting markets/1,000 people in all counties")+
  scale_x_continuous(name="Markets (per 1,000 people)")+
  scale_y_continuous(name="Number of Counties")
```

#### Comparing markets that accept SFMNP in counties that saw an increase in farmer's markets with markets in all counties. The mean of the "increase" histogram looks slightly higher than the "overall" histogram.

#### The normalized data will be used to compare the means between all counties and counties with more markets in 2016.

```{r fmdata35, echo=TRUE}
t.test(moremkts$Produce_norm, fmdata$Produce_norm, alternative = "two.sided")
```

```{r fmdata36, echo=TRUE}
t.test(moremkts$Animal_norm, fmdata$Animal_norm, alternative = "two.sided")
```

```{r fmdata37, echo=TRUE}
t.test(moremkts$Baked_norm, fmdata$Baked_norm, alternative = "two.sided")
```

```{r fmdata38, echo=TRUE}
t.test(moremkts$OtherFood_norm, fmdata$OtherFood_norm, alternative = "two.sided")
```

```{r fmdata39, echo=TRUE}
t.test(moremkts$CreditCards_norm, fmdata$CreditCards_norm, alternative = "two.sided")
```

```{r fmdata40, echo=TRUE}
t.test(moremkts$SNAP_norm, fmdata$SNAP_norm, alternative = "two.sided")
```

```{r fmdata41, echo=TRUE}
t.test(moremkts$WIC_norm, fmdata$WIC_norm, alternative = "two.sided")
```

```{r fmdata42, echo=TRUE}
t.test(moremkts$WICCash_norm, fmdata$WICCash_norm, alternative = "two.sided")
```

```{r fmdata43, echo=TRUE}
t.test(moremkts$Senior_norm, fmdata$Senior_norm, alternative = "two.sided")
```

#### Independent-sample t-tests showed that the hypotheses of the difference in means being equal to zero for all types of markets is not rejected. There is no significant difference between the means of all types of the markets in counties that saw increases and the means of the markets in all counties.

### Linear Models

```{r fmdata44, echo=TRUE}
MktTypes <- data.frame(fmdata$Markets2016, fmdata$Produce1000, fmdata$Animal1000, fmdata$Baked1000,
                       fmdata$OtherFood1000)

ggplot(MktTypes, aes(MktTypes$fmdata.Markets2016, y = Markets, color = MktTypes)) + 
  geom_smooth(aes(y = fmdata.Produce1000, col = "Produce", fmdata.Markets2016), method ="lm", se = FALSE) + 
  geom_smooth(aes(y = fmdata.Animal1000, col = "Animal", fmdata.Markets2016), method = "lm", se = FALSE) + 
  geom_smooth(aes(y = fmdata.Baked1000, col = "Baked", fmdata.Markets2016), method = "lm", se = FALSE) + 
  geom_smooth(aes(y = fmdata.OtherFood1000, col = "Other", fmdata.Markets2016), method = "lm", se = FALSE) + 
  scale_color_manual("Food Types",
                     breaks = c("Produce", "Animal", "Baked", "Other"),
                     values = c("red", "yellow", "blue", "green4")) + 
  ggtitle("Types of Food Sold in All Counties") + 
  scale_x_continuous(name="Markets per 1,000 people")
```

####Here are the different types of food sold in all counties. Interestingly, animal products have a weaker correlation with markets per 1,000.

```{r fmdata45, echo=TRUE}
PayTypes <- data.frame(fmdata$Markets2016, fmdata$CreditCards1000, fmdata$SNAP1000, fmdata$WIC1000,
                       fmdata$WICCash1000, fmdata$Senior1000)

ggplot(PayTypes, aes(PayTypes$fmdata.Markets2016, y = Markets, color = PayTypes)) + 
  geom_smooth(aes(y = fmdata.CreditCards1000, col = "Credit Cards", fmdata.Markets2016), method = "lm", se = FALSE) + 
  geom_smooth(aes(y = fmdata.SNAP1000, col = "SNAP", fmdata.Markets2016), method = "lm", se = FALSE) + 
  geom_smooth(aes(y = fmdata.WIC1000, col = "WIC", fmdata.Markets2016), method = "lm", se = FALSE) + 
  geom_smooth(aes(y = fmdata.WICCash1000, col = "WICCash", fmdata.Markets2016), method = "lm", se = FALSE) + 
  geom_smooth(aes(y = fmdata.Senior1000, col = "Senior", fmdata.Markets2016), method = "lm", se = FALSE) +
  ggtitle("Non-Cash Methods of Payment in All Counties") + 
  scale_color_manual("Payment Method",
                     breaks = c("Credit Cards", "SNAP", "WIC", "WICCash", "Senior"),
                     values = c("turquoise4", "purple4", "seagreen", "gold3", "hotpink3")) + 
  scale_x_continuous(name="Markets per 1,000 people")
```

####These are the non-cash methods of payment in all counties. WICCash's correlation with overall markets is much lower due to being established later than the other government programs.

```{r fmdata46, echo=TRUE}
MktTypesUp <- data.frame(moremkts$Markets2016, moremkts$Produce1000, moremkts$Animal1000, moremkts$Baked1000,
                         moremkts$OtherFood1000)

ggplot(MktTypesUp, aes(MktTypesUp$moremkts.Markets2016, y = Markets, color = MktTypesAll)) + 
  geom_smooth(aes(y = moremkts.Produce1000, col = "Produce", moremkts.Markets2016), method = "lm", se = FALSE) + 
  geom_smooth(aes(y = moremkts.Animal1000, col = "Animal", moremkts.Markets2016), method = "lm", se = FALSE) + 
  geom_smooth(aes(y = moremkts.Baked1000, col = "Baked", moremkts.Markets2016), method = "lm", se = FALSE) + 
  geom_smooth(aes(y = moremkts.OtherFood1000, col = "Other", moremkts.Markets2016), method = "lm", se = FALSE) + 
  scale_color_manual("Food Types",
                     breaks = c("Produce", "Animal", "Baked", "Other"),
                     values = c("red", "yellow", "blue", "green4")) + 
  ggtitle("Types of Food Sold in Counties With More Farmer's Markets in 2016") + 
  scale_x_continuous(name="Markets per 1,000 people")
```

#### These are the types of food sold in counties With more farmer's markets in 2016. Each type has a higher correlation with the overall markets than the different kinds of markets do with all counties.

```{r fmdata47, echo=TRUE}
PayTypesUp <- data.frame(moremkts$Markets2016, moremkts$CreditCards1000, moremkts$SNAP1000, moremkts$WIC1000,
                         moremkts$WICCash1000, moremkts$Senior1000)

ggplot(PayTypesUp, aes(PayTypesUp$moremkts.Markets2016, y = Markets, color = PayTypesAll)) + 
  geom_smooth(aes(y = moremkts.CreditCards1000, col = "Credit Cards", moremkts.Markets2016), method = "lm", se = FALSE) + 
  geom_smooth(aes(y = moremkts.SNAP1000, col = "SNAP", moremkts.Markets2016), method = "lm", se = FALSE) + 
  geom_smooth(aes(y = moremkts.WIC1000, col = "WIC", moremkts.Markets2016), method = "lm", se = FALSE) + 
  geom_smooth(aes(y = moremkts.WICCash1000, col = "WICCash", moremkts.Markets2016), method = "lm", se = FALSE) + 
  geom_smooth(aes(y = moremkts.Senior1000, col = "Senior", moremkts.Markets2016), method = "lm", se = FALSE) +
  ggtitle("Non-Cash Methods of Payment in Counties With More Farmer's Markets in 2016") + 
  scale_color_manual("Payment Method",
                     breaks = c("Credit Cards", "SNAP", "WIC", "WICCash", "Senior"),
                     values = c("turquoise4", "purple4", "seagreen", "gold3", "hotpink3")) + 
  scale_x_continuous(name="Markets per 1,000 people")
```

#### These are the non-cash methods of payment in counties with more farmer's markets in 2016. Each type has a higher correlation with the overall markets than the markets that accept the different payment methods do with all counties.

### Geographical distribution
#### Here is the geographical distribution of farmer's markets, with the percentage of counties in each state that have farmer's markets. The proportions of counties in each state that saw increases from 2009 to 2016 were calculated.

```{r fmdata48, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
ALmore <- moremkts[moremkts$Alabama == "1",]
ALall <- fmdata[fmdata$Alabama == "1",]
proportion_AL_up <- nrow(ALmore)/nrow(ALall)

AKmore <- moremkts[moremkts$Alaska == "1",]
AKall <- fmdata[fmdata$Alaska == "1",]
proportion_AK_up <- nrow(AKmore)/nrow(AKall)

AZmore <- moremkts[moremkts$Arizona == "1",]
AZall <- fmdata[fmdata$Arizona == "1",]
proportion_AZ_up <- nrow(AZmore)/nrow(AZall)

ARmore <- moremkts[moremkts$Arkansas == "1",]
ARall <- fmdata[fmdata$Arkansas == "1",]
proportion_AR_up <- nrow(ARmore)/nrow(ARall)

CAmore <- moremkts[moremkts$California == "1",]
CAall <- fmdata[fmdata$California == "1",]
proportion_CA_up <- nrow(CAmore)/nrow(CAall)

COmore <- moremkts[moremkts$Colorado == "1",]
COall <- fmdata[fmdata$Colorado == "1",]
proportion_CO_up <- nrow(COmore)/nrow(COall)

CTmore <- moremkts[moremkts$Connecticut == "1",]
CTall <- fmdata[fmdata$Connecticut == "1",]
proportion_CT_up <- nrow(CTmore)/nrow(CTall)

DEmore <- moremkts[moremkts$Delaware == "1",]
DEall <- fmdata[fmdata$Delaware == "1",]
proportion_DE_up <- nrow(DEmore)/nrow(DEall)

DCmore <- moremkts[moremkts$DistrictofColumbia == "1",]
DCall <- fmdata[fmdata$DistrictofColumbia == "1",]
proportion_DC_up <- nrow(DCmore)/nrow(DCall)

FLmore <- moremkts[moremkts$Florida == "1",]
FLall <- fmdata[fmdata$Florida == "1",]
proportion_FL_up <- nrow(FLmore)/nrow(FLall)

GAmore <- moremkts[moremkts$Georgia == "1",]
GAall <- fmdata[fmdata$Georgia == "1",]
proportion_GA_up <- nrow(GAmore)/nrow(GAall)

HImore <- moremkts[moremkts$Hawaii == "1",]
HIall <- fmdata[fmdata$Hawaii == "1",]
proportion_HI_up <- nrow(HImore)/nrow(HIall)

IDmore <- moremkts[moremkts$Idaho == "1",]
IDall <- fmdata[fmdata$Idaho == "1",]
proportion_ID_up <- nrow(IDmore)/nrow(IDall)

ILmore <- moremkts[moremkts$Illinois == "1",]
ILall <- fmdata[fmdata$Illinois == "1",]
proportion_IL_up <- nrow(ILmore)/nrow(ILall)

INmore <- moremkts[moremkts$Indiana == "1",]
INall <- fmdata[fmdata$Indiana == "1",]
proportion_IN_up <- nrow(INmore)/nrow(INall)

IAmore <- moremkts[moremkts$Iowa == "1",]
IAall <- fmdata[fmdata$Iowa == "1",]
proportion_IA_up <- nrow(IAmore)/nrow(IAall)

KSmore <- moremkts[moremkts$Kansas == "1",]
KSall <- fmdata[fmdata$Kansas == "1",]
proportion_KS_up <- nrow(KSmore)/nrow(KSall)

KYmore <- moremkts[moremkts$Kentucky == "1",]
KYall <- fmdata[fmdata$Kentucky == "1",]
proportion_KY_up <- nrow(KYmore)/nrow(KYall)

LAmore <- moremkts[moremkts$Louisiana == "1",]
LAall <- fmdata[fmdata$Louisiana == "1",]
proportion_LA_up <- nrow(LAmore)/nrow(LAall)

MEmore <- moremkts[moremkts$Maine == "1",]
MEall <- fmdata[fmdata$Maine == "1",]
proportion_ME_up <- nrow(MEmore)/nrow(MEall)

MDmore <- moremkts[moremkts$Maryland == "1",]
MDall <- fmdata[fmdata$Maryland == "1",]
proportion_MD_up <- nrow(MDmore)/nrow(MDall)

MAmore <- moremkts[moremkts$Massachusetts == "1",]
MAall <- fmdata[fmdata$Massachusetts == "1",]
proportion_MA_up <- nrow(MAmore)/nrow(MAall)

MImore <- moremkts[moremkts$Michigan == "1",]
MIall <- fmdata[fmdata$Michigan == "1",]
proportion_MI_up <- nrow(MImore)/nrow(MIall)

MNmore <- moremkts[moremkts$Minnesota == "1",]
MNall <- fmdata[fmdata$Minnesota == "1",]
proportion_MN_up <- nrow(MNmore)/nrow(MNall)

MSmore <- moremkts[moremkts$Mississippi == "1",]
MSall <- fmdata[fmdata$Mississippi == "1",]
proportion_MS_up <- nrow(MSmore)/nrow(MSall)

MOmore <- moremkts[moremkts$Missouri == "1",]
MOall <- fmdata[fmdata$Missouri == "1",]
proportion_MO_up <- nrow(MOmore)/nrow(MOall)

MTmore <- moremkts[moremkts$Montana == "1",]
MTall <- fmdata[fmdata$Montana == "1",]
proportion_MT_up <- nrow(MTmore)/nrow(MTall)

NEmore <- moremkts[moremkts$Nebraska == "1",]
NEall <- fmdata[fmdata$Nebraska == "1",]
proportion_NE_up <- nrow(NEmore)/nrow(NEall)

NVmore <- moremkts[moremkts$Nevada == "1",]
NVall <- fmdata[fmdata$Nevada == "1",]
proportion_NV_up <- nrow(NVmore)/nrow(NVall)

NHmore <- moremkts[moremkts$NewHampshire == "1",]
NHall <- fmdata[fmdata$NewHampshire == "1",]
proportion_NH_up <- nrow(NHmore)/nrow(NHall)

NJmore <- moremkts[moremkts$NewJersey == "1",]
NJall <- fmdata[fmdata$NewJersey == "1",]
proportion_NJ_up <- nrow(NJmore)/nrow(NJall)

NMmore <- moremkts[moremkts$NewMexico == "1",]
NMall <- fmdata[fmdata$NewMexico == "1",]
proportion_NM_up <- nrow(NMmore)/nrow(NMall)

NYmore <- moremkts[moremkts$NewYork == "1",]
NYall <- fmdata[fmdata$NewYork == "1",]
proportion_NY_up <- nrow(NYmore)/nrow(NYall)

NCmore <- moremkts[moremkts$NorthCarolina == "1",]
NCall <- fmdata[fmdata$NorthCarolina == "1",]
proportion_NC_up <- nrow(NCmore)/nrow(NCall)

NDmore <- moremkts[moremkts$NorthDakota == "1",]
NDall <- fmdata[fmdata$NorthDakota == "1",]
proportion_ND_up <- nrow(NDmore)/nrow(NDall)

OHmore <- moremkts[moremkts$Ohio == "1",]
OHall <- fmdata[fmdata$Ohio == "1",]
proportion_OH_up <- nrow(OHmore)/nrow(OHall)

OKmore <- moremkts[moremkts$Oklahoma == "1",]
OKall <- fmdata[fmdata$Oklahoma == "1",]
proportion_OK_up <- nrow(OKmore)/nrow(OKall)

ORmore <- moremkts[moremkts$Oregon == "1",]
ORall <- fmdata[fmdata$Oregon == "1",]
proportion_OR_up <- nrow(ORmore)/nrow(ORall)

PAmore <- moremkts[moremkts$Pennsylvania == "1",]
PAall <- fmdata[fmdata$Pennsylvania == "1",]
proportion_PA_up <- nrow(PAmore)/nrow(PAall)

RImore <- moremkts[moremkts$RhodeIsland == "1",]
RIall <- fmdata[fmdata$RhodeIsland == "1",]
proportion_RI_up <- nrow(RImore)/nrow(RIall)

SCmore <- moremkts[moremkts$SouthCarolina == "1",]
SCall <- fmdata[fmdata$SouthCarolina == "1",]
proportion_CA_up <- nrow(CAmore)/nrow(CAall)

SDmore <- moremkts[moremkts$SouthDakota == "1",]
SDall <- fmdata[fmdata$SouthDakota == "1",]
proportion_SD_up <- nrow(SDmore)/nrow(SDall)

TNmore <- moremkts[moremkts$Tennessee == "1",]
TNall <- fmdata[fmdata$Tennessee == "1",]
proportion_TN_up <- nrow(TNmore)/nrow(TNall)

TXmore <- moremkts[moremkts$Texas == "1",]
TXall <- fmdata[fmdata$Texas == "1",]
proportion_TX_up <- nrow(TXmore)/nrow(TXall)

UTmore <- moremkts[moremkts$Utah == "1",]
UTall <- fmdata[fmdata$Utah == "1",]
proportion_UT_up <- nrow(UTmore)/nrow(UTall)

VTmore <- moremkts[moremkts$Vermont == "1",]
VTall <- fmdata[fmdata$Vermont == "1",]
proportion_VT_up <- nrow(VTmore)/nrow(VTall)

VAmore <- moremkts[moremkts$Virginia == "1",]
VAall <- fmdata[fmdata$Virginia == "1",]
proportion_VA_up <- nrow(VAmore)/nrow(VAall)

WAmore <- moremkts[moremkts$Washington == "1",]
WAall <- fmdata[fmdata$Washington == "1",]
proportion_WA_up <- nrow(WAmore)/nrow(WAall)

WVmore <- moremkts[moremkts$WestVirginia == "1",]
WVall <- fmdata[fmdata$WestVirginia == "1",]
proportion_WV_up <- nrow(WVmore)/nrow(WVall)

WImore <- moremkts[moremkts$Wisconsin == "1",]
WIall <- fmdata[fmdata$Wisconsin == "1",]
proportion_WI_up <- nrow(WImore)/nrow(WIall)

WYmore <- moremkts[moremkts$Wyoming == "1",]
WYall <- fmdata[fmdata$Wyoming == "1",]
proportion_WY_up <- nrow(WYmore)/nrow(WYall)
```

#### The proportions of counties in each state that saw increases from 2009 to 2016 were also grouped by region (Midwest, Northeast, South; West).

#### Here are the proportions of counties in each Midwestern state that saw increases from 2009 to 2016. Half the states had the majority of their counties see increases.

```{r fmdata49, echo=TRUE}
Midwest_State <- rep(c("IL", "IN", "IA", "KS", "MI", "MN", "MO", "NE", "ND", "OH", "SD", "WI"))

Midwest_Proportion_Increased <- c(as.numeric(proportion_IL_up), as.numeric(proportion_IN_up), as.numeric(proportion_IA_up), as.numeric(proportion_KS_up), as.numeric(proportion_MI_up), as.numeric(proportion_MN_up), as.numeric(proportion_MO_up), as.numeric(proportion_NE_up), as.numeric(proportion_ND_up), as.numeric(proportion_OH_up), as.numeric(proportion_SD_up), as.numeric(proportion_WI_up))

Midwest_MktsMore <- data.frame(Midwest_State, Midwest_Proportion_Increased)

Midwest_MktsMore$Midwest_State <-factor(Midwest_MktsMore$Midwest_State, 
                                levels = c("IL", "IN", "IA", "KS", "MI", "MN", "MO", "NE", "ND", "OH", "SD", "WI"))

Midwest_Mkts_Up <- ggplot (Midwest_MktsMore, aes(Midwest_State, Midwest_Proportion_Increased))
Midwest_Mkts_Up + geom_bar(stat = "identity",fill="green4") + xlab("States (Midwest)") + ylab("Proportion") + ggtitle("Counties in Each State that saw Increases")
```

#### Here are the proportions of counties in each Northeastern state that saw increases from 2009 to 2016. All states had more than half their counties see increases; four states had all counties see increases, as had Washington, DC.

```{r fmdata50, echo=TRUE}
Northeast_State <- rep(c("CT", "DE", "DC", "ME", "MD", "MA", "NH", "NJ", "NY", "PA", "RI", "VT"))

Northeast_Proportion_Increased <- c(as.numeric(proportion_CT_up), as.numeric(proportion_DC_up), as.numeric(proportion_DE_up), as.numeric(proportion_ME_up), as.numeric(proportion_MD_up), as.numeric(proportion_MA_up), as.numeric(proportion_NH_up), as.numeric(proportion_NJ_up), as.numeric(proportion_NY_up), as.numeric(proportion_PA_up), as.numeric(proportion_RI_up), as.numeric(proportion_VT_up))

Northeast_MktsMore <- data.frame(Northeast_State, Northeast_Proportion_Increased)

Northeast_MktsMore$Northeast_State <-factor(Northeast_MktsMore$Northeast_State, 
                                  levels = c("CT", "DE", "DC", "ME", "MD", "MA", "NH", "NJ", "NY", "PA", "RI", "VT"))

Northeast_Mkts_Up <- ggplot (Northeast_MktsMore, aes(Northeast_State, Northeast_Proportion_Increased))
Northeast_Mkts_Up + geom_bar(stat = "identity",fill="blue2") + xlab("States (Northeast)") + ylab("Proportion") + ggtitle("Counties in Each State that saw Increases")
```

#### Here are the proportions of counties in each Southern state that saw increases from 2009 to 2016. The majority of states had less than half their counties see increases.

```{r fmdata51, echo=TRUE}
South_State <- rep(c("AL", "AR", "FL", "GA", "KY", "LA", "MS", "NC", "OK", "SC", "TN", "TX", "VA", "WV"))

South_Proportion_Increased <- c(as.numeric(proportion_AL_up), as.numeric(proportion_AR_up), as.numeric(proportion_FL_up), as.numeric(proportion_GA_up), as.numeric(proportion_KY_up), as.numeric(proportion_LA_up), as.numeric(proportion_MS_up), as.numeric(proportion_NC_up), as.numeric(proportion_OK_up), as.numeric(proportion_SD_up), as.numeric(proportion_TN_up), as.numeric(proportion_TX_up), as.numeric(proportion_VA_up), as.numeric(proportion_WV_up))

South_MktsMore <- data.frame(South_State, South_Proportion_Increased)

South_MktsMore$State <-factor(South_MktsMore$South_State, 
                              levels = c("AL", "AR", "FL", "GA", "KY", "LA", "MS", "NC", "OK", "SC", "TN", "TX", "VA", "WV"))

South_Mkts_Up <- ggplot (South_MktsMore, aes(South_State, South_Proportion_Increased))
South_Mkts_Up + geom_bar(stat = "identity",fill="red2") + xlab("States (South)") + ylab("Proportion") + ggtitle("Counties in Each State that saw Increases")
```

#### Here are the proportions of counties in each Western state that saw increases from 2009 to 2016. The majority of state had at least half their counties see an increase.

```{r fmdata52, echo=TRUE}
West_State <- rep(c("AK", "AZ", "CA", "CO", "HI", "ID", "MT", "NV", "NM", "OR", "UT", "WA", "WY"))

West_Proportion_Increased <- c(as.numeric(proportion_AK_up), as.numeric(proportion_AZ_up), as.numeric(proportion_CA_up), as.numeric(proportion_CO_up), as.numeric(proportion_HI_up), as.numeric(proportion_ID_up), as.numeric(proportion_MT_up), as.numeric(proportion_NV_up), as.numeric(proportion_NM_up), as.numeric(proportion_OR_up), as.numeric(proportion_UT_up), as.numeric(proportion_WA_up), as.numeric(proportion_WY_up))

West_Mkts_More <- data.frame(West_State, West_Proportion_Increased)

West_Mkts_More$West_State <-factor(West_Mkts_More$West_State, 
                        levels = c("AK", "AZ", "CA", "CO", "HI", "ID", "MT", "NV", "NM", "OR", "UT", "WA", "WY"))

West_Mkts_Up <- ggplot (West_Mkts_More, aes(West_State, West_Proportion_Increased))
West_Mkts_Up + geom_bar(stat = "identity",fill="gold2") + xlab("States (West)") + ylab("Proportion") + ggtitle("Counties in Each State that saw Increases")
```

## REGRESSION ANALYSIS

#### I choose to use supervised machine learning, specifically linear regression, because the outcome, the difference in markets per 1,000 people between 2009 and 2016, has an infinite number of possible values. Predictors include Produce1000, Animal1000, Baked1000, OtherFood1000, CreditCards1000, SNAP1000, WIC1000, WICCash1000, and Senior1000.

```{r fmdata53, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
model1 = lm(Difference ~ Produce1000 + Animal1000 + Baked1000 + OtherFood1000 + CreditCards1000 + SNAP1000 +
              WIC1000 + WICCash1000 + Senior1000, data=fmdata)
summary(model1)
SSE1 = sum(model1$residuals^2)
SSE1
```

#### The Animal, SNAP, WICCash, and Senior variables are not significant at less than 0.05, so these factors will not be used in the regression analysis.

```{r fmdata54, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
model2 = lm(Difference ~ Produce1000 + Baked1000 + OtherFood1000 + CreditCards1000 + WIC1000, data=fmdata)
summary(model2)
SSE2 = sum(model2$residuals^2)
SSE2
```

#### Now I will split the data, using 70% as a training sample and 30% as a test saample.

```{r fmdata55, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
set.seed(150)
fmdata_Split <-createDataPartition(fmdata$Difference, p = 0.7, list=FALSE)
fmdata_Train <- fmdata[fmdata_Split, ]
fmdata_Test <- fmdata[-fmdata_Split, ]

model3 = lm(Difference ~ Produce1000 + Baked1000 + OtherFood1000 + CreditCards1000 + WIC1000, data=fmdata_Train)
summary(model3)
SSE3 = sum(model3$residuals^2)
SSE3
```

#### The OtherFood variable is not significant at less than 1, so it too will be removed.

```{r fmdata56, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
model4 = lm(Difference ~ Produce1000 + Baked1000 + CreditCards1000 + WIC1000, data=fmdata_Train)
summary(model4)
SSE4 = sum(model4$residuals^2)
SSE4
```

#### I will see how well my linear regression model can predict the difference in markets per 1,000 people between the years 2009 and 2016 by measuring R^2, which represents the proportion of variability explained by the model. The closer R^2 is to 1, the more precise the prediction.

```{r fmdata57, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
predictTest <- predict(model4, newdata=fmdata_Test)
SSE4 <- sum((fmdata_Test$Difference - predictTest) ^ 2)
SST4 <- sum((fmdata_Test$Difference - mean(fmdata_Test$Difference)) ^ 2)
SquaredR4 <- 1 - SSE4/SST4
percent(SquaredR4)
```

#### Only 13.87% of the variability can be explained by this regression model, so the model is fairly weak at predicting the change in farmer's markets per 1,000 people.

```{r fmdata58, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
plot(fmdata_Test$Difference, fmdata_Test$Produce1000 + fmdata_Test$Baked1000 + fmdata_Test$CreditCards1000 +
fmdata_Test$WIC1000, main = "Regression Analysis for Farmer's Markets", xlab = "Difference in markets per 1,000 people", ylab = "Produce, Baked, Credit Cards, WIC")

abline(lm(fmdata_Test$Difference ~ fmdata_Test$Produce1000 + fmdata_Test$Baked1000 + fmdata_Test$CreditCards1000 + fmdata_Test$WIC1000))
```

#### As this plot shows, not very many points are close to the line, which shows that this is a weak model. Let's try using model1, which has all variables.

```{r fmdata59, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
predictTest <- predict(model1, newdata=fmdata_Test)
SSE1 <- sum((fmdata_Test$Difference - predictTest) ^ 2)
SST1 <- sum((fmdata_Test$Difference - mean(fmdata_Test$Difference)) ^ 2)
SquaredR1 <- 1 - SSE1/SST1
percent(SquaredR1)
```

#### This model has a slightly better R-squared value, with 21.02% of variability explained by the model, though it is still weak even with all variables.

```{r fmdata60, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
plot(fmdata_Test$Difference, fmdata_Test$Produce1000 + fmdata_Test$Animal1000 + fmdata_Test$Baked1000 +
       fmdata_Test$OtherFood1000 + fmdata_Test$CreditCards1000 + fmdata_Test$SNAP1000 + fmdata_Test$WIC1000 +
       fmdata_Test$WICCash1000 + fmdata_Test$Senior1000, main = "Regression Analysis for Farmer's Markets (All Variables)",
     xlab = "Difference in markets per 1,000 people", ylab = "All Food Types and Payment Methods")

abline(lm(fmdata_Test$Difference ~ fmdata_Test$Produce1000 + fmdata_Test$Animal1000 + fmdata_Test$Baked1000 +
            fmdata_Test$OtherFood1000 + fmdata_Test$CreditCards1000 + fmdata_Test$SNAP1000 +
            fmdata_Test$WIC1000 + fmdata_Test$WICCash1000 + fmdata_Test$Senior1000))
```

#### Compared to the previous plot, this plot has a slightly greater share of points close to the line, showing that using all variables leads to a slightly stronger model.

#### Now let's try excluding the outliers. This will involve excluding the values in the "normalized" columns greater than 1.5 or less than -1.5.

```{r fmdata61, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
fmdata_decimals <- data.frame(fmdata$SNAP1000, fmdata$WIC1000, fmdata$WICCash1000, fmdata$Senior1000,
                              fmdata$CreditCards1000, fmdata$Produce1000, fmdata$Animal1000, fmdata$Baked1000,
                              fmdata$OtherFood1000, fmdata$Difference, fmdata$Markets_2009_norm,
                              fmdata$Markets_2016_norm, fmdata$SNAP_norm, fmdata$WIC_norm,
                              fmdata$WICCash_norm, fmdata$Senior_norm, fmdata$CreditCards_norm,
                              fmdata$Produce_norm, fmdata$Animal_norm, fmdata$Baked_norm,
                              fmdata$OtherFood_norm)

Markets_no_outliers <- fmdata_decimals[fmdata_decimals$fmdata.Markets_2009_norm <= 1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.Markets_2009_norm >= -1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.Markets_2016_norm <= 1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.Markets_2016_norm >= -1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.SNAP_norm <= 1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.SNAP_norm >= -1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.WIC_norm <= 1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.WIC_norm >= -1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.WICCash_norm <= 1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.WICCash_norm >= -1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.Senior_norm <= 1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.Senior_norm >= -1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.CreditCards_norm <= 1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.CreditCards_norm >= -1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.Produce_norm <= 1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.Produce_norm >= -1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.Animal_norm <= 1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.Animal_norm >= -1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.Baked_norm <= 1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.Baked_norm >= -1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.OtherFood_norm <= 1.5,]
Markets_no_outliers <- Markets_no_outliers[Markets_no_outliers$fmdata.OtherFood_norm >= -1.5,]
```

####Now build the model.

```{r fmdata62, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
model5 = lm(fmdata.Difference ~ fmdata.Produce1000 + fmdata.Animal1000 + fmdata.Baked1000 + 
              fmdata.OtherFood1000 + fmdata.CreditCards1000 + fmdata.SNAP1000 + fmdata.WIC1000 +
              fmdata.WICCash1000 + fmdata.Senior1000, data=Markets_no_outliers)
summary(model5)
SSE5 = sum(model5$residuals^2)
SSE5
```

####Produce1000, Baked1000, SNAP1000, WIC1000, and WICCash1000 are not significant at less than 0.001, so these variables will be removed.

```{r fmdata63, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
model6 = lm(fmdata.Difference ~ fmdata.Animal1000 + fmdata.OtherFood1000 + fmdata.CreditCards1000 + 
              fmdata.Senior1000, data=Markets_no_outliers)
summary(model6)
SSE6 = sum(model6$residuals^2)
SSE6
```

####Senior1000 is not significant at less than 0.001, so these variables will be removed.

```{r fmdata64, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
model6 = lm(fmdata.Difference ~ fmdata.Animal1000 + fmdata.OtherFood1000 + fmdata.CreditCards1000, data=Markets_no_outliers)
summary(model6)
SSE6 = sum(model6$residuals^2)
SSE6
```

#### The R squared is better at 47.49% without the outliers.

####Plot the model.
```{r fmdata65, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
plot(Markets_no_outliers$fmdata.Difference, Markets_no_outliers$fmdata.Produce1000 +
       Markets_no_outliers$fmdata.Baked1000 + Markets_no_outliers$fmdata.CreditCards1000 +
       Markets_no_outliers$fmdata.WIC1000, main = "Regression Analysis for Farmer's Markets", xlab = "Difference in markets per 1,000 people", ylab = "Produce, Baked, Credit Cards, WIC")

abline(lm(Markets_no_outliers$fmdata.Difference ~ Markets_no_outliers$fmdata.Produce1000 +
            Markets_no_outliers$fmdata.Baked1000 + Markets_no_outliers$fmdata.CreditCards1000 +
            Markets_no_outliers$fmdata.WIC1000))
```


### CONCLUSIONS

#### There is a fairly weak correlation between the difference in farmer's markets per 1,000 people in 2009 and 2016, and the best predictors given: animal foods, other foods, and credit cards.

#### Using all the food types and methods of payment available in this dataset is not enough to predict the increase or decrease in farmer's markets per 1,000 people. There could be many other factors behind the change in farmer's markets, such as how people spend at markets the availability of non-food items, food trucks, and entertainment.

#### Data from just two years in time, 2009 and 2016, may not be enough. The trends could show up better in month-to-month data, more years, or a greater time range, say 20 years, rather than 7.

#### Changes in markets may vary depending on the region (Northeast, Midwest, South, West), state, or metropolitan/micropolitan area.

#### There also could be rules or regulations in some locales that add hurdles to establishing or growing farmer's markets.

### RECOMMENDATIONS FOR CLIENTS
#### 1. Survey vendors at existing markets and find out about their transactions.
#### 2. Find out about state or local laws or regulations that could influence availability of farmer's markets such as food safety laws.
#### 3. Survey markets to see if they have non-food items, food trucks, and entertainment.